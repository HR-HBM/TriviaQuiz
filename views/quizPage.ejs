<%- include("header.ejs") %>

<% if (locals.data) { %>
    <%  %>
    <div class="quiz-header">
        <% 
                const firstResult = data[0];
                const difficulty = firstResult.difficulty;
                const category = firstResult.category;

    
                const currentScore = 0;
                const totalScore = 0;
                let currentQuestionNumber = locals.currentQuestion || 1;
                const totalQuestions = data.length;
                const currentQuestion = data[currentQuestionNumber - 1];


        %>
            <h1 class="mainHeading"><%- category %></h1>
            <h2 class="subHeading">Level: <%- difficulty %></h2>

                
    </div>


    

    
    <div class="question">

        <label for="quizProgress"> <%- currentQuestionNumber %> / <%- totalQuestions %></label>
        <progress id="quizProgress" max="100" value="<%- (currentQuestionNumber/totalQuestions)*100 %>"><%- (currentQuestionNumber/totalQuestions)*100 %></progress>

        <p><%- currentQuestion.question %></p>

        <form action="/quizPage" id="answerOptions" class="answer-options" method="POST">

            <input type="hidden" name="quizData" value="<%= encodeURIComponent(JSON.stringify(data)) %>">
            <input type="hidden" name="currentQuestion" value="<%- currentQuestionNumber %>">
            <input type="hidden" name="correctAnswer" value="<%- currentQuestion.correct_answer %>">


            <% currentQuestion.shuffledAnswers.forEach(answer => { %>
                <input type="button" class="<%- answer === currentQuestion.correct_answer ? 'correct-answer' : 'incorrect-answer' %> answer-option" width="80px" value="<%- answer %>" onclick="handleAnswerClick(this, '<%= answer === currentQuestion.correct_answer %>')">
                
            <% }); %>

            <% if (currentQuestionNumber < totalQuestions) { %>
                <button type="submit" class="answer-submit-button" name="action" value="next" disabled>Next Question</button>
                <% } else { %>
                    <button type="submit" class="answer-submit-button" name="action" value="end" disabled> View Results</button>
                <% } %>
             </form>
        </div>
                    

    <% } else { %>

        <div id="tag-error" class="tag-error">

            <p>no quiz data available</p>

        </div>
     <% } %>
    

    

            

<%- include ("footer.ejs") %>
